
<h1>Listing Issues</h1>
<div class="row">
  <div class='col s12'>
    <div class="video-container">
    <div id="geolocation" style='width: 1280px; height: 1024px;'></div>
  </div>
  </div>
  </div>
<table>
  <thead>
    <tr>
        <th data-field="date">Created</th>
        <th data-field="status">Status</th>
        <th data-field="address">Address</th>
        <th data-field="category">Category</th>
        <th data-field="note">Note</th>
        <th data-field="note">Show/delete</th>
    </tr>
  </thead>

  <tbody>
    <% @issues.each do |issue| %>
      <tr >
      <td><%= issue.date.strftime('%B %e, %Y') %></td>
        <td><%= issue.issue_status %></td>
        <td><%= issue.address.full_address %></td>
        <td><%= issue.issue_category.name %></td>
        <td><%= issue.note %></td>
        <td><%= link_to 'Show', issue %></td>
        <td><%= link_to 'Edit', edit_issue_path(issue) %></td>
      </tr>
    <% end %>
  </tbody>
</table>


<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script type = "text/javascript">
var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'geolocation'} }, function(){
  if(navigator.geolocation)
    navigator.geolocation.getCurrentPosition(displayOnMap);
  markers = handler.addMarkers(<%=raw @hash.to_json %>);

  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();  
});

function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude
  });
  handler.map.centerOn(marker);
};

    
</script>
